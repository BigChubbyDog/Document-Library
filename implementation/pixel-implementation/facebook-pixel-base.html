<!-- Facebook Pixel Code -->
<script>
  !function(f,b,e,v,n,t,s)
  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};
  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
  n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];
  s.parentNode.insertBefore(t,s)}(window, document,'script',
  'https://connect.facebook.net/en_US/fbevents.js');

  // Initialize Meta Pixel with advanced matching
  fbq('init', '1072334595033391', {
    // Advanced matching parameters (automatically filled when available)
    em: 'hashed_email',
    ph: 'hashed_phone', 
    fn: 'hashed_first_name',
    ln: 'hashed_last_name',
    ct: 'hashed_city',
    st: 'hashed_state',
    zp: 'hashed_zip'
  });
  
  // Track initial page view
  fbq('track', 'PageView');
  
  // Enhanced tracking for mortgage-specific data
  window.mortgageTracking = {
    trackConversion: function(eventName, customData = {}, customerData = {}) {
      const eventData = {
        content_category: 'mortgage_services',
        content_name: customData.content_name || 'mortgage_conversion',
        value: customData.value || 100,
        currency: 'USD'
      };
      
      // Add customer data if available (will be hashed automatically)
      const userData = {};
      if (customerData.email) userData.em = customerData.email;
      if (customerData.phone) userData.ph = customerData.phone;
      if (customerData.firstName) userData.fn = customerData.firstName;
      if (customerData.lastName) userData.ln = customerData.lastName;
      if (customerData.city) userData.ct = customerData.city;
      if (customerData.state) userData.st = customerData.state;
      if (customerData.zipCode) userData.zp = customerData.zipCode;
      
      fbq('track', eventName, eventData, userData);
      console.log('Meta Pixel - Tracked:', eventName, eventData);
    }
  };
</script>
<noscript>
  <img height="1" width="1" style="display:none"
       src="https://www.facebook.com/tr?id=1072334595033391&ev=PageView&noscript=1" />
</noscript>
<!-- End Facebook Pixel Code -->